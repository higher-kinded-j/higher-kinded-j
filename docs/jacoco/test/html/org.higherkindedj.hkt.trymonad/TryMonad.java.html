<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TryMonad.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hkj-core</a> &gt; <a href="index.source.html" class="el_package">org.higherkindedj.hkt.trymonad</a> &gt; <span class="el_source">TryMonad.java</span></div><h1>TryMonad.java</h1><pre class="source lang-java linenums">// Copyright (c) 2025 Magnus Smith
// Licensed under the MIT License. See LICENSE.md in the project root for license information.
package org.higherkindedj.hkt.trymonad;

import static org.higherkindedj.hkt.trymonad.TryKindHelper.TRY;
import static org.higherkindedj.hkt.util.validation.Operation.*;

import java.util.function.Function;
import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.MonadError;
import org.higherkindedj.hkt.util.validation.Validation;

/**
 * Implements the {@link MonadError} interface for the {@link Try} data type.
 *
 * &lt;p&gt;This class provides the full set of monadic operations for {@code Try}, enabling the chaining
 * of failable computations in a functional style. It uses {@link TryKind.Witness} as its
 * higher-kinded type witness and {@link Throwable} as its error type {@code E}.
 *
 * &lt;p&gt;As a {@link MonadError} instance, it provides:
 *
 * &lt;ul&gt;
 *   &lt;li&gt;&lt;b&gt;flatMap:&lt;/b&gt; For sequencing operations where each step can fail.
 *   &lt;li&gt;&lt;b&gt;raiseError:&lt;/b&gt; For lifting a {@link Throwable} directly into a {@link Try.Failure}.
 *   &lt;li&gt;&lt;b&gt;handleErrorWith:&lt;/b&gt; For recovering from a {@link Try.Failure} with another {@code Try}
 *       computation.
 * &lt;/ul&gt;
 *
 * &lt;p&gt;This class extends {@link TryApplicative} and is implemented as a stateless singleton,
 * accessible via the {@link #INSTANCE} field.
 *
 * @see Try
 * @see TryKind.Witness
 * @see MonadError
 * @see TryApplicative
 * @see Throwable
 */
public class TryMonad extends TryApplicative implements MonadError&lt;TryKind.Witness, Throwable&gt; {

<span class="fc" id="L40">  public static final Class&lt;TryMonad&gt; TRY_MONAD_CLASS = TryMonad.class;</span>

  /** Singleton instance of {@code TryMonad}. */
<span class="fc" id="L43">  public static final TryMonad INSTANCE = new TryMonad();</span>

  /** Private constructor to enforce the singleton pattern. */
  private TryMonad() {
    // Private constructor
  }

  /**
   * Sequentially composes two {@code Try} actions, passing the result of the first into a function
   * that produces the second, and flattening the result.
   *
   * &lt;p&gt;If {@code ma} is a {@link Try.Success}, its value is passed to the function {@code f}. If
   * {@code f} returns a {@link Try.Success}, that becomes the result. If {@code f} throws an
   * exception or returns a {@link Try.Failure}, that failure is captured as the result. If {@code
   * ma} is already a {@link Try.Failure}, its error is propagated, and {@code f} is not called.
   *
   * @param &lt;A&gt; The value type of the first {@code Try}.
   * @param &lt;B&gt; The value type of the {@code Try} produced by the function {@code f}.
   * @param f The non-null function that takes the successful result of {@code ma} and returns a new
   *     {@code Kind&lt;TryKind.Witness, B&gt;}.
   * @param ma The first {@code Kind&lt;TryKind.Witness, A&gt;} to be flat-mapped over. Must not be null.
   * @return A new {@code Kind&lt;TryKind.Witness, B&gt;} representing the composed operation. Never null.
   * @throws NullPointerException if {@code f} or {@code ma} is null.
   * @throws org.higherkindedj.hkt.exception.KindUnwrapException if {@code ma} or the result of
   *     {@code f} is not a valid {@code Try} representation.
   */
  @Override
  public &lt;A, B&gt; Kind&lt;TryKind.Witness, B&gt; flatMap(
      Function&lt;? super A, ? extends Kind&lt;TryKind.Witness, B&gt;&gt; f, Kind&lt;TryKind.Witness, A&gt; ma) {

<span class="fc" id="L73">    Validation.function().validateFlatMap(f, ma, TRY_MONAD_CLASS);</span>

<span class="fc" id="L75">    Try&lt;A&gt; tryA = TRY.narrow(ma);</span>

<span class="fc" id="L77">    Try&lt;B&gt; resultTry =</span>
<span class="fc" id="L78">        tryA.flatMap(</span>
            a -&gt; {
              try {
<span class="fc" id="L81">                Kind&lt;TryKind.Witness, B&gt; kindB = f.apply(a);</span>
<span class="fc" id="L82">                Validation.function()</span>
<span class="fc" id="L83">                    .requireNonNullResult(kindB, &quot;f&quot;, TRY_MONAD_CLASS, FLAT_MAP, Kind.class);</span>
<span class="fc" id="L84">                return TRY.narrow(kindB);</span>
<span class="fc" id="L85">              } catch (Throwable t) {</span>
<span class="fc" id="L86">                return Try.failure(t);</span>
              }
            });
<span class="fc" id="L89">    return TRY.widen(resultTry);</span>
  }

  /**
   * Lifts a {@link Throwable} into a {@code Kind&lt;TryKind.Witness, A&gt;}, creating a {@link
   * Try.Failure}.
   *
   * @param &lt;A&gt; The phantom type of the value (since this is an error state).
   * @param error The non-null {@link Throwable} to raise.
   * @return A {@code Kind&lt;TryKind.Witness, A&gt;} representing {@code Try.failure(error)}. Never null.
   * @throws NullPointerException if {@code error} is null.
   */
  @Override
  public &lt;A&gt; Kind&lt;TryKind.Witness, A&gt; raiseError(Throwable error) {
<span class="fc" id="L103">    Validation.coreType().requireError(error, TRY_MONAD_CLASS, RAISE_ERROR);</span>
<span class="fc" id="L104">    return TRY.widen(Try.failure(error));</span>
  }

  /**
   * Handles an error in a {@code Kind&lt;TryKind.Witness, A&gt;}. If {@code ma} is a {@link Try.Failure},
   * the {@code handler} function is applied to its {@link Throwable} to produce a recovery {@code
   * Kind&lt;TryKind.Witness, A&gt;}. If {@code ma} is a {@link Try.Success}, it is returned unchanged.
   *
   * @param &lt;A&gt; The type of the value.
   * @param ma The {@code Kind&lt;TryKind.Witness, A&gt;} that might have failed. Must not be null.
   * @param handler The non-null function that takes a {@link Throwable} and returns a new {@code
   *     Kind&lt;TryKind.Witness, A&gt;}, providing a chance to recover.
   * @return A {@code Kind&lt;TryKind.Witness, A&gt;} representing either the original success, or the
   *     result of the error handler. Never null.
   * @throws NullPointerException if {@code ma} or {@code handler} is null.
   * @throws org.higherkindedj.hkt.exception.KindUnwrapException if {@code ma} or the result of
   *     {@code handler} is not a valid {@code Try} representation.
   */
  @Override
  public &lt;A&gt; Kind&lt;TryKind.Witness, A&gt; handleErrorWith(
      Kind&lt;TryKind.Witness, A&gt; ma,
      Function&lt;? super Throwable, ? extends Kind&lt;TryKind.Witness, A&gt;&gt; handler) {

<span class="fc" id="L127">    Validation.function().validateHandleErrorWith(ma, handler, TRY_MONAD_CLASS);</span>

<span class="fc" id="L129">    Try&lt;A&gt; tryA = TRY.narrow(ma);</span>

<span class="fc" id="L131">    Try&lt;A&gt; resultTry =</span>
<span class="fc" id="L132">        tryA.recoverWith(</span>
            throwable -&gt; {
              try {
<span class="fc" id="L135">                Kind&lt;TryKind.Witness, A&gt; recoveryKind = handler.apply(throwable);</span>
<span class="fc" id="L136">                Validation.function()</span>
<span class="fc" id="L137">                    .requireNonNullResult(</span>
                        recoveryKind, &quot;handler&quot;, TRY_MONAD_CLASS, HANDLE_ERROR_WITH, Kind.class);
<span class="fc" id="L139">                return TRY.narrow(recoveryKind);</span>
<span class="fc" id="L140">              } catch (Throwable t) {</span>
<span class="fc" id="L141">                return Try.failure(t);</span>
              }
            });
<span class="fc" id="L144">    return TRY.widen(resultTry);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>
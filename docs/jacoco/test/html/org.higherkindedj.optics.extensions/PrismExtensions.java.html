<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrismExtensions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hkj-core</a> &gt; <a href="index.source.html" class="el_package">org.higherkindedj.optics.extensions</a> &gt; <span class="el_source">PrismExtensions.java</span></div><h1>PrismExtensions.java</h1><pre class="source lang-java linenums">// Copyright (c) 2025 Magnus Smith
// Licensed under the MIT License. See LICENSE.md in the project root for license information.
package org.higherkindedj.optics.extensions;

import java.util.Optional;
import java.util.function.Function;
import org.higherkindedj.hkt.either.Either;
import org.higherkindedj.hkt.maybe.Maybe;
import org.higherkindedj.hkt.validated.Validated;
import org.higherkindedj.optics.Prism;
import org.jspecify.annotations.NullMarked;

/**
 * Static utility methods for using {@link Prism} with hkj-core types (Maybe, Either, Validated).
 *
 * &lt;p&gt;This class provides ergonomic helpers for common patterns when working with prisms and
 * optional or fallible operations.
 *
 * &lt;p&gt;Example usage:
 *
 * &lt;pre&gt;{@code
 * import static org.higherkindedj.optics.extensions.PrismExtensions.*;
 *
 * Prism&lt;JsonValue, JsonString&gt; stringPrism = JsonValuePrisms.jsonString();
 *
 * // Get as Maybe instead of Optional
 * Maybe&lt;JsonString&gt; maybeString = getMaybe(stringPrism, jsonValue);
 *
 * // Get as Either with error message
 * Either&lt;String, JsonString&gt; stringOrError =
 *     getEither(stringPrism, &quot;Not a string value&quot;, jsonValue);
 *
 * // Modify with validation
 * Either&lt;String, JsonValue&gt; result = modifyEither(
 *     stringPrism,
 *     str -&gt; str.value().length() &gt; 0
 *         ? Either.right(str)
 *         : Either.left(&quot;String cannot be empty&quot;),
 *     jsonValue
 * );
 * }&lt;/pre&gt;
 */
@NullMarked
public final class PrismExtensions {
  /** Private constructor to prevent instantiation. */
  private PrismExtensions() {}

  /**
   * Gets the value from a {@link Prism} wrapped in a {@link Maybe}.
   *
   * &lt;p&gt;This converts the standard {@link Optional} result to {@link Maybe}.
   *
   * @param prism The prism to get the value from
   * @param source The source structure
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Maybe.just(value)} if the prism matches, {@code Maybe.nothing()} otherwise
   */
  public static &lt;S, A&gt; Maybe&lt;A&gt; getMaybe(Prism&lt;S, A&gt; prism, S source) {
<span class="fc" id="L60">    return prism.getOptional(source).map(Maybe::just).orElse(Maybe.nothing());</span>
  }

  /**
   * Gets the value from a {@link Prism} wrapped in an {@link Either}.
   *
   * &lt;p&gt;If the prism doesn't match, the result will be {@code Either.left(errorValue)}.
   *
   * @param prism The prism to get the value from
   * @param errorValue The error value to use if the prism doesn't match
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Either.right(value)} if the prism matches, {@code Either.left(errorValue)}
   *     otherwise
   */
  public static &lt;E, S, A&gt; Either&lt;E, A&gt; getEither(Prism&lt;S, A&gt; prism, E errorValue, S source) {
<span class="fc" id="L78">    return prism.getOptional(source).map(Either::&lt;E, A&gt;right).orElse(Either.left(errorValue));</span>
  }

  /**
   * Gets the value from a {@link Prism} wrapped in a {@link Validated}.
   *
   * &lt;p&gt;If the prism doesn't match, the result will be {@code Validated.invalid(errorValue)}.
   *
   * @param prism The prism to get the value from
   * @param errorValue The error value to use if the prism doesn't match
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Validated.valid(value)} if the prism matches, {@code
   *     Validated.invalid(errorValue)} otherwise
   */
  public static &lt;E, S, A&gt; Validated&lt;E, A&gt; getValidated(Prism&lt;S, A&gt; prism, E errorValue, S source) {
<span class="fc" id="L96">    return prism</span>
<span class="fc" id="L97">        .getOptional(source)</span>
<span class="fc" id="L98">        .map(Validated::&lt;E, A&gt;valid)</span>
<span class="fc" id="L99">        .orElse(Validated.invalid(errorValue));</span>
  }

  /**
   * Modifies the value with a function that returns {@link Maybe}.
   *
   * &lt;p&gt;If the prism doesn't match or the function returns {@code Maybe.nothing()}, returns {@code
   * Maybe.nothing()}.
   *
   * @param prism The prism to modify through
   * @param f The modification function returning {@code Maybe}
   * @param source The source structure
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Maybe.just(updatedSource)} if successful, {@code Maybe.nothing()} otherwise
   */
  public static &lt;S, A&gt; Maybe&lt;S&gt; modifyMaybe(Prism&lt;S, A&gt; prism, Function&lt;A, Maybe&lt;A&gt;&gt; f, S source) {
<span class="fc" id="L116">    return prism</span>
<span class="fc" id="L117">        .getOptional(source)</span>
<span class="fc" id="L118">        .map(Maybe::just)</span>
<span class="fc" id="L119">        .orElse(Maybe.nothing())</span>
<span class="fc" id="L120">        .flatMap(f)</span>
<span class="fc" id="L121">        .map(prism::build);</span>
  }

  /**
   * Modifies the value with a function that returns {@link Either}.
   *
   * &lt;p&gt;If the prism doesn't match, returns {@code Either.left(noMatchError)}. If the function
   * returns an error, that error is returned.
   *
   * @param prism The prism to modify through
   * @param noMatchError Error to return if the prism doesn't match
   * @param f The modification function returning {@code Either}
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Either.right(updatedSource)} if successful, {@code Either.left(error)} otherwise
   */
  public static &lt;E, S, A&gt; Either&lt;E, S&gt; modifyEither(
      Prism&lt;S, A&gt; prism, E noMatchError, Function&lt;A, Either&lt;E, A&gt;&gt; f, S source) {
<span class="fc" id="L141">    return prism</span>
<span class="fc" id="L142">        .getOptional(source)</span>
<span class="fc" id="L143">        .map(Either::&lt;E, A&gt;right)</span>
<span class="fc" id="L144">        .orElse(Either.left(noMatchError))</span>
<span class="fc" id="L145">        .flatMap(f)</span>
<span class="fc" id="L146">        .map(prism::build);</span>
  }

  /**
   * Modifies the value with a function that returns {@link Validated}.
   *
   * &lt;p&gt;If the prism doesn't match, returns {@code Validated.invalid(noMatchError)}.
   *
   * @param prism The prism to modify through
   * @param noMatchError Error to return if the prism doesn't match
   * @param f The modification function returning {@code Validated}
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Validated.valid(updatedSource)} if successful, {@code Validated.invalid(error)}
   *     otherwise
   */
  public static &lt;E, S, A&gt; Validated&lt;E, S&gt; modifyValidated(
      Prism&lt;S, A&gt; prism, E noMatchError, Function&lt;A, Validated&lt;E, A&gt;&gt; f, S source) {
<span class="fc" id="L166">    return prism</span>
<span class="fc" id="L167">        .getOptional(source)</span>
<span class="fc" id="L168">        .map(Validated::&lt;E, A&gt;valid)</span>
<span class="fc" id="L169">        .orElse(Validated.invalid(noMatchError))</span>
<span class="fc" id="L170">        .flatMap(f)</span>
<span class="fc" id="L171">        .map(prism::build);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>
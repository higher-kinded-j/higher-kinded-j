<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LensExtensions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hkj-core</a> &gt; <a href="index.source.html" class="el_package">org.higherkindedj.optics.extensions</a> &gt; <span class="el_source">LensExtensions.java</span></div><h1>LensExtensions.java</h1><pre class="source lang-java linenums">// Copyright (c) 2025 Magnus Smith
// Licensed under the MIT License. See LICENSE.md in the project root for license information.
package org.higherkindedj.optics.extensions;

import java.util.function.Function;
import org.higherkindedj.hkt.either.Either;
import org.higherkindedj.hkt.maybe.Maybe;
import org.higherkindedj.hkt.trymonad.Try;
import org.higherkindedj.hkt.validated.Validated;
import org.higherkindedj.optics.Lens;
import org.jspecify.annotations.NullMarked;

/**
 * Static utility methods for using {@link Lens} with hkj-core types (Maybe, Either, Validated,
 * Try).
 *
 * &lt;p&gt;This class provides ergonomic helpers for common patterns when working with lenses and
 * fallible or optional operations.
 *
 * &lt;p&gt;Example usage:
 *
 * &lt;pre&gt;{@code
 * import static org.higherkindedj.optics.extensions.LensExtensions.*;
 *
 * Lens&lt;User, String&gt; emailLens = UserLenses.email();
 *
 * // Get as Maybe (null-safe)
 * Maybe&lt;String&gt; email = getMaybe(emailLens, user);
 *
 * // Get as Either with error message
 * Either&lt;String, String&gt; emailOrError = getEither(emailLens, &quot;No email found&quot;, user);
 *
 * // Modify with validation
 * Either&lt;String, User&gt; result = modifyEither(
 *     emailLens,
 *     email -&gt; email.contains(&quot;@&quot;)
 *         ? Either.right(email)
 *         : Either.left(&quot;Invalid email format&quot;),
 *     user
 * );
 * }&lt;/pre&gt;
 */
@NullMarked
public final class LensExtensions {
  /** Private constructor to prevent instantiation. */
  private LensExtensions() {}

  /**
   * Gets the value from a {@link Lens} wrapped in a {@link Maybe}.
   *
   * &lt;p&gt;This is null-safe; if the lens returns {@code null}, the result will be {@code
   * Maybe.nothing()}.
   *
   * @param lens The lens to get the value from
   * @param source The source structure
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Maybe.just(value)} if non-null, {@code Maybe.nothing()} otherwise
   */
  public static &lt;S, A&gt; Maybe&lt;A&gt; getMaybe(Lens&lt;S, A&gt; lens, S source) {
<span class="fc" id="L61">    return Maybe.fromNullable(lens.get(source));</span>
  }

  /**
   * Gets the value from a {@link Lens} wrapped in an {@link Either}.
   *
   * &lt;p&gt;If the lens returns {@code null}, the result will be {@code Either.left(errorValue)}.
   *
   * @param lens The lens to get the value from
   * @param errorValue The error value to use if the lens returns null
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Either.right(value)} if non-null, {@code Either.left(errorValue)} otherwise
   */
  public static &lt;E, S, A&gt; Either&lt;E, A&gt; getEither(Lens&lt;S, A&gt; lens, E errorValue, S source) {
<span class="fc" id="L78">    A value = lens.get(source);</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">    return value != null ? Either.right(value) : Either.left(errorValue);</span>
  }

  /**
   * Gets the value from a {@link Lens} wrapped in a {@link Validated}.
   *
   * &lt;p&gt;If the lens returns {@code null}, the result will be {@code Validated.invalid(errorValue)}.
   *
   * @param lens The lens to get the value from
   * @param errorValue The error value to use if the lens returns null
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Validated.valid(value)} if non-null, {@code Validated.invalid(errorValue)}
   *     otherwise
   */
  public static &lt;E, S, A&gt; Validated&lt;E, A&gt; getValidated(Lens&lt;S, A&gt; lens, E errorValue, S source) {
<span class="fc" id="L97">    A value = lens.get(source);</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">    return value != null ? Validated.valid(value) : Validated.invalid(errorValue);</span>
  }

  /**
   * Modifies the value with a function that returns {@link Maybe}.
   *
   * &lt;p&gt;If the function returns {@code Maybe.nothing()}, the entire operation results in {@code
   * Maybe.nothing()}, indicating that the modification failed. The original source is not preserved
   * in the result and must be handled by the caller if needed (e.g., via {@code orElse(source)}).
   *
   * @param lens The lens to modify through
   * @param f The modification function returning {@code Maybe}
   * @param source The source structure
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Maybe.just(updatedSource)} if successful, {@code Maybe.nothing()} if the
   *     function returned nothing
   */
  public static &lt;S, A&gt; Maybe&lt;S&gt; modifyMaybe(Lens&lt;S, A&gt; lens, Function&lt;A, Maybe&lt;A&gt;&gt; f, S source) {
<span class="fc" id="L117">    return f.apply(lens.get(source)).map(newValue -&gt; lens.set(newValue, source));</span>
  }

  /**
   * Modifies the value with a function that returns {@link Either}.
   *
   * &lt;p&gt;If the function returns {@code Either.left(error)}, that error is returned. Otherwise, the
   * source is updated with the new value.
   *
   * @param lens The lens to modify through
   * @param f The modification function returning {@code Either}
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Either.right(updatedSource)} if successful, {@code Either.left(error)} otherwise
   */
  public static &lt;E, S, A&gt; Either&lt;E, S&gt; modifyEither(
      Lens&lt;S, A&gt; lens, Function&lt;A, Either&lt;E, A&gt;&gt; f, S source) {
<span class="fc" id="L136">    return f.apply(lens.get(source))</span>
<span class="fc" id="L137">        .fold(Either::left, newValue -&gt; Either.right(lens.set(newValue, source)));</span>
  }

  /**
   * Modifies the value with a function that returns {@link Validated}.
   *
   * &lt;p&gt;If the function returns {@code Validated.invalid(error)}, that error is returned. Otherwise,
   * the source is updated with the new value.
   *
   * @param lens The lens to modify through
   * @param f The modification function returning {@code Validated}
   * @param source The source structure
   * @param &lt;E&gt; The type of the error value
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Validated.valid(updatedSource)} if successful, {@code Validated.invalid(error)}
   *     otherwise
   */
  public static &lt;E, S, A&gt; Validated&lt;E, S&gt; modifyValidated(
      Lens&lt;S, A&gt; lens, Function&lt;A, Validated&lt;E, A&gt;&gt; f, S source) {
<span class="fc" id="L157">    return f.apply(lens.get(source))</span>
<span class="fc" id="L158">        .fold(Validated::invalid, newValue -&gt; Validated.valid(lens.set(newValue, source)));</span>
  }

  /**
   * Modifies the value with a function that may throw exceptions.
   *
   * &lt;p&gt;If the function throws an exception, it is caught and returned as {@code Try.failure}.
   * Otherwise, the source is updated with the new value.
   *
   * @param lens The lens to modify through
   * @param f The modification function that may throw
   * @param source The source structure
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Try.success(updatedSource)} if successful, {@code Try.failure(exception)} if an
   *     exception was thrown
   */
  public static &lt;S, A&gt; Try&lt;S&gt; modifyTry(Lens&lt;S, A&gt; lens, Function&lt;A, Try&lt;A&gt;&gt; f, S source) {
<span class="fc" id="L176">    return f.apply(lens.get(source))</span>
<span class="fc" id="L177">        .fold(newValue -&gt; Try.success(lens.set(newValue, source)), Try::failure);</span>
  }

  /**
   * Sets a value if it passes a validation function.
   *
   * &lt;p&gt;This is useful for conditional updates based on business rules.
   *
   * @param lens The lens to set through
   * @param validator Validation function that returns error message if invalid
   * @param newValue The new value to set
   * @param source The source structure
   * @param &lt;S&gt; The type of the source structure
   * @param &lt;A&gt; The type of the focused part
   * @return {@code Either.right(updatedSource)} if valid, {@code Either.left(errorMessage)}
   *     otherwise
   */
  public static &lt;S, A&gt; Either&lt;String, S&gt; setIfValid(
      Lens&lt;S, A&gt; lens, Function&lt;A, Either&lt;String, A&gt;&gt; validator, A newValue, S source) {
<span class="fc" id="L196">    return validator</span>
<span class="fc" id="L197">        .apply(newValue)</span>
<span class="fc" id="L198">        .fold(Either::left, validValue -&gt; Either.right(lens.set(validValue, source)));</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>